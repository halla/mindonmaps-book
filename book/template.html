<!DOCTYPE html>
<html>
◊(define (get-depth ptree-item)
 1)

◊(define (get-depth-string ptree-item)
   (string-append "depth-" (number->string (get-depth ptree-item))))

◊(define (has-grandchildren? ptree-item) 
   (let ([cs (children ptree-item)])
     (if cs
         (ormap children cs) 
         #f)))

◊(define (get-grandchildren-string ptree-item)
   (if (has-grandchildren? ptree-item)
       "has-grandchildren"
       "no-grandchildren"))

◊(define (get-level ptree-item) 
   (define (iter ptree-item n) 
     (if (equal? ptree-item 'pagetree-root)
         n
         (iter (parent ptree-item) (+ n 1))))
   (iter ptree-item 0))

◊(define (get-level-string ptree-item)
   (string-append "level-" (number->string (get-level ptree-item))))

◊(define (get-toc-class ptree-item)
   (string-append (get-level-string ptree-item) " " (get-grandchildren-string ptree-item))
)


◊(define (toc-item x)
   (let ([sub-pages (children x)])
     `(li        
       (a [[href ,(string-append "/" (symbol->string x)) ]] 
          ,(->html (select-from-doc 'h1 x)))
       ,(if sub-pages
           `(ul  [[class ,(get-toc-class x) ]] ,@(map toc-item sub-pages)
               )
           (span)))))



◊(define (toc)
   (let ([child-pages (children here)])
     (->html `(ul [[class ,(get-toc-class here) ]]
              ,@(map toc-item child-pages)))))

◊(define prev-page (previous here))
◊(define next-page (next here))
◊(define (page-title page) (->html (select-from-doc 'h1 page)))


<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>◊select['h1 doc] | Mind on Maps</title>

<link rel="stylesheet" type="text/css" media="all" href="/book/styles/tufte.css" />
<link rel="stylesheet" type="text/css" media="all" href="/book/styles/styles.css" />
<script type="text/javascript" src="/book/scripts/mousetrap.min.js"></script>
</head>
<body class="◊page-class[(->html (select-from-doc 'h1 here))]">
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=◊|gtm-tag|"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','◊|gtm-tag|');</script>
<!-- End Google Tag Manager -->
<div id="main-content">◊->html[doc]



</div>

<div id="toc">
  ◊when/block[(children here)]{ ◊toc{} }
</div>


<div id="footer">
  <div class="navigation">
    ◊when/block[prev-page]{ <a class="prev-link" title="Prev: Left arrow" href="/◊|prev-page|">&larr; ◊(page-title prev-page)</a>}
    
    ◊when/block[(not (equal? 'pagetree-root (parent here)))]{    
    <a class="home-link" title="Home: Esc" href="/◊(next 'pagetree-root)">Home</a>
    ◊when/block[(not (equal? 'pagetree-root (parent (parent here))))]{    
    <a class="chapter-link" href="/◊(parent here)">Chapter</a>
    }}
    ◊when/block[next-page]{
    <a class="next-link" title="Next: Right arrow" href="/◊|next-page|">◊(page-title next-page) &rarr; </a>}  
  </div>
  <div class="page-meta"><span class="book-title"><a href="/">Mind on Maps</a></span> — expand your memory, index your mind, organize your life</div>
</div>


<script type="text/javascript" src="/book/scripts/site.js"></script>
</body>
</html>
